<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Artworks</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="navigation-buttons">
        <a href="{{ url_for('welcome') }}">Welcome</a>
        <a href="{{ url_for('profile') }}">Profile</a>
    </div>
    {% if basket_artworks %}
    <div class="basket-view">
        <h2>Your Basket</h2>
        <div class="basket-items">
            {% if basket_artworks %}
                {% for artwork in basket_artworks %}
                    <div class="basket-item">
                        <div class="basket-item-img">
                            <img src="{{ url_for('static', filename='Artworks/' + artwork['ArtworkID']|string + '.jpg') }}">
                        </div>
                        <div class="basket-artwork-details">
                            <p class="basket-artwork-title">{{ artwork['ATitle'] }}</p>
                            <p class="basket-artwork-price">Price: ${{ artwork['Price'] }}</p>
                        </div>
                        <form method="POST" action="{{ url_for('remove_from_basket') }}">
                            <input type="hidden" name="artwork_id" value="{{ artwork['ArtworkID'] }}">
                            <button type="submit">Remove</button>
                        </form>
                    </div>
                {% endfor %}
            {% else %}
                <p>Your basket is empty.</p>
            {% endif %}
        </div>
        <div class="basket-summary">
            <strong>Total Price: ${{ total_price }}</strong>
        </div>
        <div class="basket-actions">
            <button onclick="checkout()">Checkout</button>
        </div>
    </div>
    {% endif %}


    <!-- Artwork Grid Section -->
    <div class="artwork-grid">
        {% for artwork in artworks %}
            <div class="artwork-column">
                <div class="artwork-item">
                    <a href="{{ url_for('artwork_details', artwork_id=artwork['artwork_id']) }}">
                        <img src="{{ url_for('static', filename='Artworks/' + artwork['artwork_id']|string + '.jpg') }}" alt="{{ artwork['artwork_title'] }}">
                        <h3>{{ artwork['artwork_title'] }}</h3>
                    </a>
                </div>
                <div class="artwork-rating">
                    <p>Average Rating: {{ artwork.average_rating }}</p>
                </div>
                <div class="artwork-comments">
                    {% for comment in artwork.comments %}
                        <p>
                            {% if comment.is_artist %}
                                <a href="{{ url_for('artist_details', artist_id=comment.artist_id) }}" style="color: blue;">
                                    {{ comment.user_name }}
                                </a>
                            {% else %}
                                {{ comment.user_name }}
                            {% endif %}:
                            {{ comment.comment }}
                        </p>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        function checkout() {
            // Create an AJAX request
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/checkout", true);
            xhr.setRequestHeader("Content-Type", "application/json");
        
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        alert("Checkout successful!");
                        window.location.reload(); // Reloads the current page
                    } else {
                        alert("Checkout failed: " + response.message);
                        // Handle failure, maybe stay on the page for the user to try again
                    }
                }
            };
        
            // Sending request to the server
            xhr.send();
        }
        </script>
        
</body>

</html>
